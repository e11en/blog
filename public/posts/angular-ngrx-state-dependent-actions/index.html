<!DOCTYPE html>
<html lang="en-us">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Angular Ngrx State Dependent Actions | Coding Blog</title>
<link rel="stylesheet" href="http://blog.ellenlangelaar.nl/css/style.css">
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/default.min.css">


<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="http://blog.ellenlangelaar.nl"><h1 class="title is-4">Coding Blog</h1></a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          
        </nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    <h2 class="subtitle is-6">February 15, 2018</h2>
    <h1 class="title">Angular Ngrx State Dependent Actions</h1>
    <div class="content">
      <p><strong>C depends on B -&gt; B depends on A.</strong></p>

<ul>
<li>First, notice that I am setting the value of the courses property to the result of the <code>switchMap()</code> operator.</li>
<li>I use the <code>do()</code> operator to tranparently perform an action (or side effect), in this case, to <code>dispatch()</code> the LoadCoursesForUserAction action. The <code>do()</code> operator will receive the user that is emitted from the observable that is created using the <code>select()</code> method.</li>

<li><p>Finally, using the <code>switchMap()</code> operator, the inner observable (obtaining the user) is complete, returning the observable of the array of Course objects.</p>

<pre><code>public administrator = false;
public group: Observable&lt;Group&gt;;
public users: Observable&lt;Array&lt;User&gt;&gt;;

ngOnInit() {
    this.group = this.activatedRoute.paramMap
    .takeWhile(() =&gt; this.alive)
    .do(params =&gt; this.store.dispatch(new LoadGroupAction({ id: params.get('id') })))
    .switchMap(() =&gt; this.store.select('userGroup'));

    this.users = this.group
    .do(group =&gt; this.store.dispatch(new LoadUsersInGroupAction({ group: group })))
    .switchMap(() =&gt; this.store.select('users'));

    this.administrator = this.group
    .switchMap(group =&gt; this.store.select('authUser')
        .switchMap(user =&gt; Observable.of(group.security.administrators.indexOf(user.id &gt; -1))
    );
}

ngOnDestroy() {
    this.alive = false;
}
</code></pre></li>
</ul>

<p>Source: <a href="http://brianflove.com/2017/11/01/ngrx-anti-patterns/">RxJS Antipatterns</a></p>

    </div>
  </div>
</section>


<section class="section">
  <div class="container has-text-centered">
    <p></p>
  </div>
</section>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script>

<script>hljs.initHighlightingOnLoad();</script>


